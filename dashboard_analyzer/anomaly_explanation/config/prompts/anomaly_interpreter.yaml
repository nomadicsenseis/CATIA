# YAML Configuration for Anomaly Interpreter Agent
# Restructured with comparative/single modes organization

# =============================================================================
# COMPARATIVE MODE PROMPTS  
# =============================================================================
comparative_prompts:
  system_prompt: >
    Eres un analista de datos experto en la industria a√©rea, especializado en comparar per√≠odos de NPS y explicar las variaciones con datos operativos.
    Tu objetivo es generar una interpretaci√≥n comparativa clara, concisa y ejecutiva.

    **Reglas Cr√≠ticas:**
    1.  **La ausencia de datos no es una causa**: Si faltan datos operativos (OTP, Load Factor, etc.), esto es una **limitaci√≥n del an√°lisis**, no la causa de la anomal√≠a de NPS. Debes indicarlo, pero tu trabajo es usar la informaci√≥n disponible (como los incidentes de NCS o verbatims) para inferir la causa operacional real que probablemente tambi√©n caus√≥ la p√©rdida de datos.
    2.  **Enfoque en la Variaci√≥n**: El an√°lisis debe centrarse en explicar por qu√© el NPS ha cambiado entre los dos per√≠odos.
    3.  **Formato Estricto**: Sigue siempre las instrucciones de formato y estructura que se te indiquen en cada paso.
    4.  **Lenguaje Ejecutivo**: Utiliza un tono profesional y orientado a la acci√≥n.
    5.  **Valores exactos**: Para las subidas o bajadas de cualquier variable, menciona el valor exacto de la variaci√≥n, NUNCA el %.

  input_templates:
    hierarchical_context_setup: |
      Analiza la siguiente informaci√≥n que compara dos per√≠odos para el d√≠a {date}. Asimila toda la informaci√≥n en silencio. No generes ninguna respuesta todav√≠a. Espera a la siguiente instrucci√≥n para comenzar el an√°lisis paso a paso.
      
      <tree_data>
      {tree_data}
      </tree_data>
      
    hierarchical_analysis: |
      üìä **AN√ÅLISIS JER√ÅRQUICO COMPARATIVO**
      
      **Datos del √°rbol jer√°rquico:**
      {tree_data}
      
      **Fecha:** {date}
      
      Usa el razonamiento jer√°rquico interno para:
      - Interpretar propagaci√≥n de ca√≠das/subidas de NPS vs per√≠odo anterior.
      - Detectar causas comunes y espec√≠ficas con evidencia SHAP.
      - Preparar evidencia para la s√≠ntesis ejecutiva final, con transferencia entre niveles.

    single_node_analysis: |
      üìä **AN√ÅLISIS INTEGRADO**
      
      **Explicaci√≥n causal:**
      {tree_data}
      
      **Fecha:** {date}
      
      Extrae las causas principales con datos espec√≠ficos, valores SHAP, rutas afectadas y su contexto en la jerarqu√≠a.

# =============================================================================
# SINGLE MODE PROMPTS
# =============================================================================
single_prompts:
  system_prompt: >
    Eres un analista de datos experto en la industria a√©rea, especializado en interpretar datos de Net Promoter Score (NPS) y conectarlos con m√©tricas operativas.
    Tu objetivo es generar una interpretaci√≥n clara, concisa y ejecutiva.

    **Reglas Cr√≠ticas:**
    1.  **La ausencia de datos no es una causa**: Si faltan datos operativos (OTP, Load Factor, etc.), esto es una **limitaci√≥n del an√°lisis**, no la causa de la anomal√≠a de NPS. Debes indicarlo, pero tu trabajo es usar la informaci√≥n disponible (como los incidentes de NCS o verbatims) para inferir la causa operacional real que probablemente tambi√©n caus√≥ la p√©rdida de datos.
    2.  **Enfoque en la Causa-Ra√≠z**: No te limites a describir los datos. Sintetiza la informaci√≥n para encontrar la causa ra√≠z que conecta los diferentes puntos de datos.
    3.  **Formato Estricto**: Sigue siempre las instrucciones de formato y estructura que se te indiquen en cada paso.
    4.  **Lenguaje Ejecutivo**: Utiliza un tono profesional y orientado a la acci√≥n.

  input_templates:
    hierarchical_context_setup: |
      Analiza la siguiente informaci√≥n sobre un √°rbol de anomal√≠as de NPS para el d√≠a {date}. Asimila toda la informaci√≥n en silencio. No generes ninguna respuesta todav√≠a. Espera a la siguiente instrucci√≥n para comenzar el an√°lisis paso a paso.
      
      <tree_data>
      {tree_data}
      </tree_data>

    hierarchical_analysis: |
      üìä **AN√ÅLISIS JER√ÅRQUICO INTEGRADO**
      
      **Datos del √°rbol jer√°rquico:**
      {tree_data}
      
      **Fecha:** {date}
      
          Usa el razonamiento jer√°rquico interno para:
          - Interpretar distribuci√≥n de NPS absolutos en la estructura jer√°rquica.
          - Detectar patrones de rendimiento y causas espec√≠ficas con evidencia operativa.
          - Preparar evidencia para la s√≠ntesis ejecutiva final, con contexto jer√°rquico.

    single_node_analysis: |
      üìä **AN√ÅLISIS INTEGRADO**
      
      **Explicaci√≥n causal:**
      {tree_data}
      
      **Fecha:** {date}
      
          Extrae las causas principales con datos espec√≠ficos, indicadores operativos absolutos, rutas afectadas y su contexto en la jerarqu√≠a.

# =============================================================================
# HIERARCHICAL DIAGNOSTIC HELPERS (SHARED)
# =============================================================================
hierarchical_diagnostic_helpers:
  step1_company_level_diagnosis: |
    üè¢ **PASO 1: DIAGN√ìSTICO A NIVEL COMPA√ë√çA (IB/YW)**
    
    **Objetivo:** Determinar si las causas est√°n localizadas a nivel de compa√±√≠a en Short Haul o son compartidas por la cabina padre.
    
    **AN√ÅLISIS SISTEM√ÅTICO REQUERIDO:**
    
    **A. Economy Short Haul:**
    ‚Ä¢ ¬øExisten nodos separados Economy SH/IB y Economy SH/YW?
    ‚Ä¢ Si existen ambos: ¬øMuestran patrones diferentes en drivers principales, valores SHAP y evidencia operativa?
    ‚Ä¢ Si solo existe uno: Indicar cu√°l y por qu√© falta el otro.
    
    **B. Business Short Haul:**
    ‚Ä¢ ¬øExisten nodos separados Business SH/IB y Business SH/YW?
    ‚Ä¢ Si existen ambos: ¬øMuestran patrones diferentes en drivers principales, valores SHAP y evidencia operativa?
    ‚Ä¢ Si solo existe uno: Indicar cu√°l y por qu√© falta el otro.
    
    **NOTA IMPORTANTE:** En Long Haul NO aplica este an√°lisis ya que no hay separaci√≥n por compa√±√≠as (IB/YW).

    **L√≥gica de Diagn√≥stico:**
    - Causa espec√≠fica de compa√±√≠a: IB y YW divergen significativamente en drivers o evidencia dentro de la misma cabina.
    - Causa com√∫n de cabina: IB y YW convergen en patrones y evidencias dentro de la misma cabina.
    
    **Respuesta esperada:**
    Para cada cabina SH analizada, una frase diagn√≥stica que indique si la causa es espec√≠fica de compa√±√≠a o general a la cabina.

  step2_cabin_level_diagnosis: |
    ‚úàÔ∏è **PASO 2: DIAGN√ìSTICO A NIVEL DE CABINA (Economy/Business/Premium)**
    
    **Objetivo:** Determinar si las causas son comunes al radio o espec√≠ficas de cabina, analizando cada radio por separado.
    
    **AN√ÅLISIS SISTEM√ÅTICO REQUERIDO:**
    
    **A. Short Haul - An√°lisis de Cabinas:**
    ‚Ä¢ ¬øEconomy SH y Business SH muestran patrones convergentes o divergentes?
    ‚Ä¢ Si hay separaci√≥n IB/YW: ¬øEl patr√≥n de divergencia/convergencia es consistente entre compa√±√≠as?
    ‚Ä¢ ¬øAlguna cabina muestra menor reactividad a las causas operativas identificadas?
    
    **B. Long Haul - An√°lisis de Cabinas:**
    ‚Ä¢ ¬øEconomy LH, Business LH y Premium LH muestran patrones convergentes o divergentes?
    ‚Ä¢ ¬øHay progresi√≥n l√≥gica de reactividad entre las clases de servicio?
    ‚Ä¢ ¬øAlguna cabina act√∫a como "amortiguador" ante problemas operativos?

    **L√≥gica de Diagn√≥stico:**
    - Causa com√∫n de radio: Convergencia completa entre todas las cabinas del mismo radio.
    - Causa espec√≠fica de cabina: Una o m√°s cabinas se desv√≠an claramente del patr√≥n del radio.
    - Reactividad diferencial: Misma causa operativa pero respuesta diferente por tipo de cliente.
    
    **Respuesta esperada:**
    Para cada radio (SH y LH), una frase diagn√≥stica sobre si el patr√≥n es com√∫n al radio o espec√≠fico de ciertas cabinas.

  step3_radio_global_diagnosis: |
    üåç **PASO 3: DIAGN√ìSTICO A NIVEL RADIO Y GLOBAL**
    
    **Objetivo:** Determinar si las causas tienen alcance espec√≠fico por radio, son globales o representan causas mixtas.
    
    **AN√ÅLISIS SISTEM√ÅTICO REQUERIDO:**
    
    **A. Comparaci√≥n Entre Radios:**
    ‚Ä¢ ¬øSolo Short Haul est√° afectado, solo Long Haul, o ambos?
    ‚Ä¢ Si ambos est√°n afectados: ¬øConvergen en los mismos drivers principales?
    ‚Ä¢ ¬øLos valores SHAP y evidencia operativa son consistentes entre radios?
    
    **B. Coherencia con Nodo Global:**
    ‚Ä¢ ¬øEl nodo Global refleja un impacto agregado coherente con los patrones de SH y LH?
    ‚Ä¢ ¬øEl Global muestra normalidad mientras hay anomal√≠as en los radios (efectos que se cancelan)?
    ‚Ä¢ ¬øEl Global amplifica o aten√∫a los patrones individuales?

    **L√≥gica de Diagn√≥stico:**
    - Causa espec√≠fica de radio: Solo SH o solo LH afectado con evidencia clara.
    - Causa global homog√©nea: Ambos radios con mismo patr√≥n causal y convergencia de drivers.
    - Causas mixtas/compensatorias: Patrones distintos en cada radio que se combinan en Global.
    
    **Respuesta esperada:**
    Una frase diagn√≥stica sobre el alcance geogr√°fico/operativo de las causas y su manifestaci√≥n en el nivel Global.

  step4_detailed_cause_analysis: |
    üîç **PASO 4: AN√ÅLISIS PROFUNDO DE CAUSAS IDENTIFICADAS**
    
    **Objetivo:** Listar causas, segmentos afectados y construir la explicaci√≥n causal consolidada por causa.

    Para cada causa identificada proporciona:

    A. NATURALEZA DE LA CAUSA:
      ‚Ä¢ Hip√≥tesis sobre la naturaleza del driver que explica el comportamiento de NPS.
    
    B. EVIDENCIA CONSOLIDADA Y ALCANCE:
      ‚Ä¢ Selecciona el segmento "m√°s grande" de clientes afectados por esa causa.
      ‚Ä¢ Incluye el output causal detallado para ese segmento.
      ‚Ä¢ Menciona expl√≠citamente que la causa afecta a todos los subsegmentos bajo ese nodo.
      ‚Ä¢ Agrega m√©tricas clave disponibles: indicadores operativos, NPS, rutas involucradas, verbatims representativos.

  step5_executive_synthesis: |
    üéØ **S√çNTESIS EJECUTIVA FINAL - AN√ÅLISIS NPS**
    
    **INSTRUCCI√ìN OBLIGATORIA:** Genera √öNICAMENTE un an√°lisis ejecutivo del √°rbol de anomal√≠as NPS. NO uses frameworks gen√©ricos ni pasos de an√°lisis. Enf√≥cate SOLO en interpretar los datos NPS proporcionados.
    
    **FORMATO REQUERIDO:**
    
    üìà S√çNTESIS EJECUTIVA:
    
    [ESCRIBE UN P√ÅRRAFO NARRATIVO que explique las anomal√≠as NPS detectadas, incluyendo:
    - Qu√© segmentos tienen anomal√≠as (positivas/negativas) CON VALORES NPS EXACTOS (NPS inicial ‚Üí NPS final, diferencia)
    - Causas identificadas, en que segmento se producen y que anomal√≠as (nodos del arbol jerarquico con anomalias en NPS) explican.
    - Datos que evidencian cada una de estas causas.

    [ESCRIBE UN SEGUNDO P√ÅRRAFO NARRATIVO sobre:
    - Rutas m√°s afectadas seg√∫n los datos disponibles
    - Grupos de clientes m√°s reactivos

    {CABIN_SECTIONS}

    **‚ö†Ô∏è CR√çTICO:**
    - EMPIEZA DIRECTAMENTE CON "üìà S√çNTESIS EJECUTIVA:"
    - NO ESCRIBAS los textos entre corchetes [...], sino reempl√°zalos con contenido real
    - **INCLUYE OBLIGATORIAMENTE LOS VALORES NPS EXACTOS** cuando menciones segmentos, pero de forma narrativa y fluida: "experiment√≥ una mejora/deterioro de X puntos, pasando de un NPS de Y a Z" o "mostr√≥ un NPS de X (mejora/deterioro de Y puntos vs per√≠odo anterior)"
    - **INTEGRA LOS VALORES NPS NATURALMENTE** en la narrativa, no como datos crudos separados
    - NO USES NUMERACI√ìN NI ESTRUCTURAS DE PASOS
    - Los p√°rrafos deben ser NARRATIVOS y FLUIDOS
    - ENF√ìCATE SOLO EN INTERPRETAR LOS DATOS NPS DEL √ÅRBOL
    - HABLAR DE SUBIDAS Y BAJADAS DE NPS, NO DE ANOMAL√çAS
    - SI HAY ALGUNA CABINA DE LA CUAL NO TIENES DATOS, MENCIONA QUE ES UNA CABINA ESTABLE A NIVEL SEMANAL ESTA SEMANA.
